{% extends "base.html.j2" %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/best_recordings.css') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/taxonomic_filters.css') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/taxonomy_display.css') }}">
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/pagination.css') }}">
{% endblock %}

{% block content %}
<!-- Statistics line (kept below navigation) -->
<div class="recording-stats" id="stats" role="status" aria-live="polite" aria-label="{{ _('Recording statistics') }}">
    <span>{{ _('Loading statistics...') }}</span>
</div>

{% include 'components/taxonomic_filters.html.j2' %}

<div id="detections-container" role="region" aria-label="{{ _('Best recordings list') }}" aria-live="polite">
    <div class="loading-indicator">{{ _('Loading recordings...') }}</div>
</div>

<div id="pagination" class="pagination">
    <!-- Pagination controls will be added here by JavaScript -->
</div>

{% include 'components/pagination.html.j2' %}

<!-- Hidden HTML Templates for JavaScript (for i18n) -->
<div id="js-templates" style="display: none;">
    <!-- Recording entry template -->
    <template id="recording-entry-template">
        <div class="detection-entry">
            <button class="play-button" data-action="play" title="{{ _('Play recording') }}"></button>
            <div>
                <div style="font-weight: 500;" data-field="name"></div>
                <div style="font-size: 0.8rem; color: var(--color-text-tertiary);">
                    <em>
                        <span class="taxonomy-link" data-action="filter-genus" data-field="genus"></span>
                        <span class="taxonomy-link" data-action="filter-species" data-field="species-part"></span>
                    </em>
                </div>
                <div style="font-size: 0.7rem; color: var(--color-text-tertiary);">
                    <span data-field="order"></span> ·
                    <span class="taxonomy-link" data-action="filter-family" data-field="family"></span>
                </div>
            </div>
            <div data-field="date"></div>
            <div data-field="time"></div>
            <div style="text-align: right;" data-field="confidence"></div>
            <div class="audio-status"></div>
        </div>
    </template>

    <!-- Filter tag template -->
    <template id="filter-tag-template">
        <div class="filter-tag">
            <span data-field="label"></span>: <span data-field="value"></span>
            <span class="filter-tag-remove" data-action="remove">×</span>
        </div>
    </template>

    <!-- Statistics template -->
    <template id="stats-template">
        <span><span class="stat-value" data-field="count"></span> {{ _('recordings') }}</span> ·
        <span><span class="stat-value" data-field="species"></span> {{ _('species') }}</span> ·
        <span>{{ _('Average confidence') }}: <span class="stat-value" data-field="avg-confidence"></span></span> ·
        <span>{{ _('Date range') }}: <span class="stat-value" data-field="date-range"></span></span>
    </template>

    <!-- Loading indicator -->
    <div id="loading-indicator-template" class="loading-indicator">{{ _('Loading recordings...') }}</div>

    <!-- No results message -->
    <div id="no-results-template" class="no-results">{{ _('No recordings found matching the selected filters.') }}</div>

    <!-- Error message -->
    <div id="error-template" class="no-results">{{ _('Error loading recordings. Please try again.') }}</div>

</div>

{% endblock %}

{% block scripts %}
    {{ super() }}
    <!-- Shared components -->
    <script src="{{ request.url_for('static', path='js/taxonomic_filters.js') }}"></script>
    <!-- Best recordings JavaScript -->
    <script src="{{ request.url_for('static', path='js/best_recordings.js') }}"></script>
{% endblock %}

<!DOCTYPE html>
<html lang="{{ language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page_name %}{{ page_name }} - {{ config['site_name'] }}{% else %}{{ config['site_name'] }}{% endif %}</title>

    {# Core styles - always included #}
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/style.css') }}">

    {# Update banner styles - needed globally #}
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/update_banner.css') }}">

    {# Block for additional styles #}
    {% block styles %}{% endblock %}

    {# Block for head content (meta tags, etc.) #}
    {% block head %}{% endblock %}
</head>
<body>
    {# Header section - consistent across all pages #}
    <header role="banner">
        {% block header %}
        <h1>
            <span class="main-title">{{ config['site_name'] }}</span>
            {% if page_name %}
            <span class="subtitle-separator">|</span>
            <span class="subtitle-text">{{ page_name }}</span>
            {% endif %}
            <span class="pulse-indicator" aria-label="{{ _('System health status') }}" role="status" id="system-health-indicator"></span>
        </h1>
        <p class="tagline" aria-label="{{ _('System information') }}">
            {{ _('Continuous acoustic monitoring') }} ·
            {% if system_status and system_status.device_name %}{{ system_status.device_name }}{% else %}{{ _('Docker Container') }}{% endif %} ·
            {{ _('%(lat)s, %(lng)s', lat=config['latitude'], lng=config['longitude']) }}
        </p>
        {% endblock %}
    </header>

    {# Update and development warning banners #}
    {% include 'components/update_banner.html.j2' %}

    {# Navigation - can be overridden but usually included #}
    {% block navigation %}
        {% include 'components/navigation.html.j2' %}
    {% endblock %}

    {# Main content area #}
    <main role="main">
        {% block content %}
        {# Page-specific content goes here #}
        {% endblock %}
    </main>

    {# Footer section - templates can override or extend #}
    <footer role="contentinfo">
        {% block footer_annotation %}
        {# Default footer annotation - pages can override or extend with super() #}
        <p class="annotation">
            {{ _('BirdNET') }} {{ config['model'].split('_')[3] if '_' in config['model'] else config['model'] }} ·
            {{ _('Confidence threshold') }} ≥{{ config['species_confidence_threshold'] }} ·
            {{ config['timezone'] }}
            {% if model_update_date %} · {{ _('Last model update:') }} {{ model_update_date }}{% endif %}
        </p>
        {% endblock %}
    </footer>

    {# Site configuration - available to all JavaScript #}
    <script>
    window.siteConfig = {
        latitude: {{ config['latitude'] }},
        longitude: {{ config['longitude'] }},
        timezone: "{{ config['timezone'] }}"
    };
    </script>

    {# Core JavaScript - always loaded #}
    <script src="{{ request.url_for('static', path='js/i18n.js') }}"></script>
    <script src="{{ request.url_for('static', path='js/base.js') }}"></script>
    <script src="{{ request.url_for('static', path='js/navigation.js') }}"></script>
    <script src="{{ request.url_for('static', path='js/update_banner.js') }}"></script>

    {# Block for page-specific scripts #}
    {% block scripts %}{% endblock %}
</body>
</html>

<!doctype html>
<html>
  <head>
    <title>BirdNET-Pi Views</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" type="text/css" href="/static/dialog-polyfill.css" />
  </head>
  <body>
    <div class="topnav" id="myTopnav">
      <form action="" method="GET" id="views">
        <button type="submit" name="view" value="Overview" form="views">
          Overview
        </button>
      </form>
      <form action="" method="GET" id="views">
        <button
          type="submit"
          name="view"
          value="Todays Detections"
          form="views"
        >
          Today's Detections
        </button>
      </form>
      <form action="" method="GET" id="views">
        <button type="submit" name="view" value="Spectrogram" form="views">
          Spectrogram
        </button>
      </form>
      <button type="button" onclick="loadBestRecordings()">
        Best Recordings
      </button>

      <form action="" method="GET" id="views">
        <button type="submit" name="view" value="Daily Charts" form="views">
          Daily Charts
        </button>
      </form>
      <button type="button" onclick="loadRecordings()">Recordings</button>
      <button type="button" onclick="loadLog()">View Log</button>
      <form action="" id="toolsbtn" method="GET" id="views">
        <button type="submit" name="view" value="Tools" form="views">
          Tools{% if commits_behind > 0 %}
          <div class="updatenumber">{{ commits_behind }}</div>
          {% endif %}
        </button>
      </form>
      <button href="javascript:void(0);" class="icon" onclick="myFunction()">
        <img src="/static/images/menu.png" />
      </button>
    </div>

    <script>
      function myFunction() {
        var x = document.getElementById("myTopnav");
        if (x.className === "topnav") {
          x.className += " responsive";
        } else {
          x.className = "topnav";
        }
      }
    </script>

    <div class="views">
      <pre id="logContent"></pre>
      <ul id="recordingsList"></ul>
      <ul id="bestRecordingsList"></ul>
    </div>

    <script>
      async function loadLog() {
        const response = await fetch("/log");
        const logText = await response.text();
        document.getElementById("logContent").textContent = logText;
      }

      async function loadRecordings() {
        const response = await fetch("/recordings");
        const data = await response.json();
        const recordingsList = document.getElementById("recordingsList");
        recordingsList.innerHTML = ""; // Clear previous list
        data.recordings.forEach((recording) => {
          const listItem = document.createElement("li");
          listItem.textContent = recording;
          recordingsList.appendChild(listItem);
        });
      }

      async function loadBestRecordings() {
        const response = await fetch("/best_recordings");
        const data = await response.json();
        const bestRecordingsList =
          document.getElementById("bestRecordingsList");
        bestRecordingsList.innerHTML = ""; // Clear previous list
        data.best_recordings.forEach((recording) => {
          const listItem = document.createElement("li");
          listItem.textContent = `${recording.species} - ${recording.confidence} - ${recording.timestamp}`;
          bestRecordingsList.appendChild(listItem);
        });
      }
    </script>
  </body>
</html>

rules:
  - id: pytest-docstring-should-prefix
    patterns:
      - pattern-either:
          # Single-line docstrings in test functions
          - patterns:
              - pattern: |
                  def $FUNC(...):
                    """$DOCSTRING"""
                    ...
              - metavariable-regex:
                  metavariable: $FUNC
                  regex: ^test_.*
              - metavariable-regex:
                  metavariable: $DOCSTRING
                  regex: ^(?!Should\s).*
          # Multi-line docstrings in test functions  
          - patterns:
              - pattern: |
                  def $FUNC(...):
                    """
                    $DOCSTRING
                    ...
                    """
                    ...
              - metavariable-regex:
                  metavariable: $FUNC
                  regex: ^test_.*
              - metavariable-regex:
                  metavariable: $DOCSTRING
                  regex: ^(?!Should\s).*
          # Single-line docstrings in test methods
          - patterns:
              - pattern-inside: |
                  class $CLASS:
                    ...
              - pattern: |
                  def $METHOD(...):
                    """$DOCSTRING"""
                    ...
              - metavariable-regex:
                  metavariable: $CLASS
                  regex: ^Test.*
              - metavariable-regex:
                  metavariable: $METHOD
                  regex: ^test_.*
              - metavariable-regex:
                  metavariable: $DOCSTRING
                  regex: ^(?!Should\s).*
          # Multi-line docstrings in test methods
          - patterns:
              - pattern-inside: |
                  class $CLASS:
                    ...
              - pattern: |
                  def $METHOD(...):
                    """
                    $DOCSTRING
                    ...
                    """
                    ...
              - metavariable-regex:
                  metavariable: $CLASS
                  regex: ^Test.*
              - metavariable-regex:
                  metavariable: $METHOD
                  regex: ^test_.*
              - metavariable-regex:
                  metavariable: $DOCSTRING
                  regex: ^(?!Should\s).*
    message: |
      Test docstring should start with "Should" to describe expected behavior.
      Consider rewriting the docstring to follow BDD conventions.
    languages: [python]
    severity: WARNING
    paths:
      include:
        - "**/test_*.py"
        - "**/*_test.py"
        - "**/tests/**/*.py"
        - "**/tests.py"
    metadata:
      category: best-practice
      technology:
        - pytest
        - python
      confidence: HIGH
      likelihood: LOW
      impact: LOW
      subcategory:
        - documentation
        - bdd
      references:
        - https://pytest.org
        - https://docs.pytest.org/en/stable/goodpractices.html

  - id: docstring-pep257-multiline-format
    pattern: |
      def $FUNC(...):
        """
        $REST
        """
        ...
    message: |
      PEP 257: Multi-line docstring summary should start on the same line as the opening quotes.
      Change from:
        """
        Summary here
        """
      To:
        """Summary here.
        
        More details if needed.
        """
    languages: [python]
    severity: WARNING
    paths:
      include:
        - "**/test_*.py"
        - "**/*_test.py"
        - "**/tests/**/*.py"
        - "**/tests.py"
    metadata:
      category: style
      technology:
        - python
      confidence: HIGH
      likelihood: LOW
      impact: LOW
      subcategory:
        - pep257
      references:
        - https://www.python.org/dev/peps/pep-0257/
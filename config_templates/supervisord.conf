[supervisord]
nodaemon=true

[unix_http_server]
file=/dev/shm/supervisor.sock   ; path to your socket file

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///dev/shm/supervisor.sock ; use a unix:// URL  for a unix socket

[program:caddy]
command=/usr/bin/caddy run --config /etc/caddy/Caddyfile
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:fastapi]
command=/usr/local/bin/uv run uvicorn birdnetpi.web.main:app --host 0.0.0.0 --port 8888
autostart=true
autorestart=true
stdout_logfile=/var/log/fastapi.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=10
stderr_logfile=/var/log/fastapi_err.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=10
environment=PYTHONPATH=/app/src

[program:pulseaudio]
command=pulseaudio --daemonize=no --exit-idle-time=-1
autostart=true
autorestart=true
stdout_logfile=/var/log/pulseaudio.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=10
stderr_logfile=/var/log/pulseaudio_err.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=10

[program:audio_capture]
command=/usr/local/bin/uv run audio-capture-daemon
autostart=true
autorestart=true
stdout_logfile=/var/log/audio_capture.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=10
stderr_logfile=/var/log/audio_capture_err.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=10
environment=PYTHONPATH=/app/src
depends_on=pulseaudio

[program:audio_analysis]
command=/usr/local/bin/uv run audio-analysis-daemon
autostart=true
autorestart=true
stdout_logfile=/var/log/audio_analysis.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=10
stderr_logfile=/var/log/audio_analysis_err.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=10
environment=PYTHONPATH=/app/src
depends_on=audio_capture

[program:audio_websocket]
command=/usr/local/bin/uv run audio-websocket-daemon
autostart=true
autorestart=true
stdout_logfile=/var/log/audio_websocket.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=10
stderr_logfile=/var/log/audio_websocket_err.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=10
environment=PYTHONPATH=/app/src
depends_on=audio_capture
